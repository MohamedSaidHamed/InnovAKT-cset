<?xml version="1.0" encoding="UTF-8"?>
<WixBundle xmlns="http://wixtoolset.org/schemas/v4/wxs/bundle"
           Name="InnovAKT-CSET Installer"
           Version="12.5.0.0"
           Manufacturer="InnovAKT"
           UpgradeCode="A1B2C3D4-E5F6-7890-1234-56789ABCDEF0">

  <BootstrapperApplicationRef Id="WixStandardBootstrapperApplication.HyperlinkLicense">
    <bal:WixStandardBootstrapperApplication
        xmlns:bal="http://wixtoolset.org/schemas/v4/wxs/bal"
        LicenseUrl=""
        ShowVersion="yes"
        SuppressOptionsUI="yes"
        SuppressRepair="yes"
        SuppressRemove="no"
        />
  </BootstrapperApplicationRef>

  <Chain>
    <!-- SQL Server LocalDB 2022 -->
    <PackageGroupRef Id="SqlLocalDB2022Package" />

    <!-- .NET 7 Desktop Runtime -->
    <PackageGroupRef Id="DotNet7DesktopRuntimePackage" />

    <!-- ASP.NET Core 7 Runtime -->
    <PackageGroupRef Id="AspNetCore7RuntimePackage" />

    <!-- Main Application MSI -->
    <MsiPackage Id="MainMsiPackage"
                SourceFile="$(var.ProjectDir)\installer\InnovAKT-CSET.msi"
                DisplayName="InnovAKT-CSET Application"
                ForcePerMachine="yes"
                Permanent="no"
                Vital="yes"
                Compressed="yes" />
  </Chain>

  <!-- Prerequisite Package Definitions -->
  <Fragment>
    <PackageGroup Id="SqlLocalDB2022Package">
        <ExePackage Id="SqlLocalDB2022"
                    SourceFile="$(var.ProjectDir)\installer\downloads\SqlLocalDB2022.msi"
                    InstallCommand="/quiet /norestart"
                    DetectCondition="VersionNT64 AND (NOT (ProductCode = '{A1B2C3D4-E5F6-4A7B-8C9D-0E1F2A3B4C5D}'))"
                    Permanent="yes"
                    Vital="yes"
                    Compressed="yes" />
    </PackageGroup>

    <PackageGroup Id="DotNet7DesktopRuntimePackage">
        <ExePackage Id="DotNet7DesktopRuntime"
                    SourceFile="$(var.ProjectDir)\installer\downloads\windowsdesktop-runtime-7.0.20-win-x64.exe"
                    InstallCommand="/quiet /norestart"
                    DetectCondition="VersionNT64 AND (NOT (ProductCode = '{B1C2D3E4-F5A6-4B7C-8D9E-0F1A2B3C4D5E}'))"
                    Permanent="yes"
                    Vital="yes"
                    Compressed="yes" />
    </PackageGroup>

    <PackageGroup Id="AspNetCore7RuntimePackage">
        <ExePackage Id="AspNetCore7DesktopRuntime"
                    SourceFile="$(var.ProjectDir)\installer\downloads\aspnetcore-runtime-7.0.20-win-x64.exe"
                    InstallCommand="/quiet /norestart"
                    DetectCondition="VersionNT64 AND (NOT (ProductCode = '{C1D2E3F4-A5B6-4C7D-8E9F-0A1B2C3D4E5F}'))"
                    Permanent="yes"
                    Vital="yes"
                    Compressed="yes" />
    </PackageGroup>
  </Fragment>
</WixBundle>